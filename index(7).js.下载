(()=>{"use strict";const d="NWG";var c=(e=>(e.SlowNetWork="SNW",e.NormalNetWork="NNW",e))(c||{});class s{constructor(o){this.scope=o}logMessage(o,t,n=!1){const r=`[${o}] [${this.scope}] ${new Date().toISOString()}: ${t}`;n?console.error(r):window?._ecoNet_?.isDebug&&console.log(r)}info(o){this.logMessage("EcoNET:INFO",o)}error(o){this.logMessage("EcoNET:ERROR",o,!0)}}const f=new s("NetGradeInfo"),S=1957,g="NetworkConfig",p=14*24*60*60*1e3;function E(){const e=W();if(e){const{__xconfig_meta__:o}=e;if(o){const{updateTime:t}=o;Date.now()-t>p&&w().then(()=>{f.info("updateNetWorkConfig success")})}return e}else return w().then(()=>{f.info("updateNetWorkConfig success")}),{defaultNetworkSpeedThreshold:S,defaultNetworkGrade:c.NormalNetWork}}function W(){const e=localStorage.getItem(g);if(!e)return null;try{return JSON.parse(e)}catch{return null}}function A(){return fetch("https://s.alicdn.com/@xconfig/EcoNet/networkSpeedMap").then(e=>e.json())}function w(){return A().then(e=>{localStorage.setItem(g,JSON.stringify(e))}).catch(e=>f.error(e))}function $(){if(document.currentScript)return document.currentScript.src;try{throw new Error}catch(e){const t=e.stack;if(t){const r=/https?:\/\/.*?\.js/.exec(t);if(r)return r[0]}}return null}function C(e){const o=/cdn-ecoNet\/(\d+\.\d+\.\d+)\//,t=e.match(o);return t&&t[1]?t[1]:null}const m=new s("Iframe");function I(e,o){let t=document.getElementById(o);return t||(t=document.createElement("iframe"),t.id=o,t.name=o,t.src=e,t.style.display="none",t.style.visibility="hidden",document.body.appendChild(t),t)}function T(e,o,t){window.addEventListener("message",function n(r){if(r.origin!=="https://s.alicdn.com"||r.source!==e.contentWindow)return;m.info(`Message from iframe: ${JSON.stringify(r.data)}`),new URL(window.location.href).searchParams.get("ecoNet")!=="y"&&document.body.removeChild(e),window.removeEventListener("message",n)}),e.contentWindow?e.contentWindow.postMessage(o,t):m.error("iframe contentWindow is null")}function y(e){const o="1.0.0",t=$(),r=`https://s.alicdn.com/@g/icbu-fe/cdn-ecoNet/${C(t||"")||o}/index.html`;m.info(`iframeSrc:${r}`);const a="ecoNetIframe",l="https://s.alicdn.com",i=I(r,a);i.onload=()=>{T(i,{key:d,value:e},l)}}const N=new s("Cookie");function _(e){const o=F(window.location.hostname);y(e),v(d,e,o),N.info(`setNetWorkGrade:${d} ${e}`),window._ecoNet_?window._ecoNet_.netWorkGrade=e:window._ecoNet_={netWorkGrade:e},N.info("setNetWorkGrade success")}function v(e,o,t){const n=new Date;n.setFullYear(n.getFullYear()+1);const r=navigator.userAgent.toLowerCase(),a=/chrome|chromium|crios/,l=/(?:chrome|chromium|crios)\/(\d+)/;let i=a.test(r),L=i?parseInt(r.match(l)?.[1]||""):0,k=`${e}=${o}; path=/; domain=${t}; expires=${n.toUTCString()}; Secure; SameSite=None`,R=`${e}=; path=/; domain=${t}; expires=Thu, 01 Jan 1970 00:00:00 GMT; Secure; SameSite=None`;i&&L>=118&&(k+="; Partitioned",document.cookie=R),document.cookie=k}function F(e){const o=e.split(".");return o.length>2?"."+o.slice(-2).join("."):e}function M(e,o){if(window.goldlog){window.goldlog.record(e,"CLK",o,"GET");return}(window.goldlog_queue||(window.goldlog_queue=[])).push({action:"goldlog.record",arguments:[e,"CLK",o,"GET"]})}const B="/sc.bb.ecoNet";function h(e,o){const t=Object.keys(o).filter(n=>n in o).filter(n=>["lcp","fcp","cls","inp","timeToFirstByte","id"].includes(n)).map(n=>`${n}=${o[n]}`).join("&");return M(B,`NetWorkGrade=${e}&isCookieWrote=true&${t}`)}const u=new s("EcoNet");(async function(){const o=E();await D(()=>typeof window.__BB_PARAMS__<"u"),u.info(`EcoNet: window.__BB_PARAMS__ is ready ${window.__BB_PARAMS__}`),u.info(`EcoNet: window._ecoNet ${window._ecoNet_}`);const{networkSpeed:n}=window.__BB_PARAMS__.common,r=window.__BB_PARAMS__.cwv;return n<o.defaultNetworkSpeedThreshold?(u.info(`\u5F53\u524D\u7F51\u7EDC\u901F\u5EA6\u4E3A${n}kb/s, \u4F4E\u4E8E${o.defaultNetworkSpeedThreshold}kb/s, \u5B9A\u4E49\u4E3A ${c.SlowNetWork}`),h(c.SlowNetWork,r),_(c.SlowNetWork)):(u.info(`\u5F53\u524D\u7F51\u7EDC\u901F\u5EA6\u4E3A${n}kb/s, \u9AD8\u4E8E${o.defaultNetworkSpeedThreshold}kb/s, \u5B9A\u4E49\u4E3A ${c.NormalNetWork}`),h(c.NormalNetWork,r),_(c.NormalNetWork))})();function D(e,o=1e3){return new Promise(t=>{let n=null;const r=()=>{e()&&(n&&clearInterval(n),t())};r(),document.addEventListener("DOMContentLoaded",r),n=setInterval(r,o)})}})();
